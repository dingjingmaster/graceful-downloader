# graceful downloader

> 一款基于 C 语言的下载后端，计划支持主流的下载传输协议，目前已支持 `http` 和 `https` 简单下载

## 说明

在写爬虫或者做指定站点资源抓取的时候，一定会有这样的苦恼，那就是在抓取大文件时候，后续文件统一下载是否该由爬虫负责？答案当然是否定的，由此，这款下载器的适用范围就算确定下来了。

## 依赖

|依赖库|适用说明|
| --- | --- |
|`gio-2.0`|文件属性获取使用|
|`glib-2.0`|参数检查的宏、数据结构适用|
|`libpthread`|下载使用|
|`librt`|时间相关使用|
|`ssl`和`crypto`|tcp传输加密使用(https)|
|命令`doxygen`|生成文档需要|

## 使用说明

1. 下载上述所需依赖
2. 在源码目录执行 `cmake -B build -S . && cd build && make -j8`（如无意外，此时已经在源码目录下的 `build` 且编译通过了）
3. 执行 `nohup ./graceful-downloader &` 启动下载的后台程序
4. 执行 `./graceful-downloader  <http url>` 开始使用 `http` 下载文件，默认文件保存到 `~/Download` (也就是家目录下的 `下载` 里)

## 项目结构

|目录|说明|
|---|---|
|core|主要是常用库代码和下载协议的实现|
|src|下载器入口|
|demo|小模块的例子|
|doc|core目录下源码生成的说明文档(在编译目录下生成)|

### `core` 目录下结构说明

|文件`[.h/.c]`|说明|
| --- | --- |
|protocol-interface|下载过程的抽象(下载前准备、下载过程、下载完成后资源释放)，所有下载协议都实现这三个`函数指针`|
|download-manager|整个下载流程的控制中心，实现新下载协议后要在函数 `bool protocol_register ();` 里添加记录|
|dm-xxx|protocol-interface 里相关功能的实现，一个协议写一个，最终它实现的三个函数需要在 download-manager 里注册|
|其它文件...|一些必须的基础功能实现|


# TODO

项目只是为了学习，很多功能都不具备，以下列出一些后续会完善的方面

[ ] 多线程下载支持（比如:获取http头，根据请求文件大小自动创建多个线程分段下载并存储）
[ ] `http/https` 重定向等功能支持（需要解析 http/https 返回头，根据返回状态码做一些工作）
[ ] 提供dbus接口，供其它程序添加下载任务，并支持下载进度反馈（目前可以通过命令行添加下载任务，无进度反馈）
[ ] 下载文件冲突处理
[ ] 下载过程文件与完成下载后文件的区分
[ ] 下载任务进度及信息查看


# Change log

